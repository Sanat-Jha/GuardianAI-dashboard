
{% extends 'accounts/base.html' %}

{% block content %}
<div class="mb-8">
  <h2 class="text-2xl font-bold uppercase tracking-widest text-primary mb-6">Your Children</h2>
  {% if children %}
    <div class="grid gap-6">
      {% for c in children %}
        <div class="glass-card">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <div>
              <span class="text-lg font-semibold text-primary">{{ c.get_full_name }}</span>
              <span class="ml-2 text-sm text-secondary">hash: <span class="font-mono">{{ c.child_hash }}</span></span>
            </div>
          </div>
          {% for child, st_list in children_screen_time.items %}
            {% if child == c and st_list %}
              <details class="mt-4">
                <summary class="cursor-pointer text-accent font-medium">Screen time (last 30 days)</summary>
                <ul class="mt-2 space-y-2">
                  {% for st in st_list %}
                    <li class="bg-black/30 rounded-lg p-3">
                      <div class="flex flex-wrap gap-4">
                        <span><span class="font-semibold text-primary">Date:</span> {{ st.date }}</span>
                        <span><span class="font-semibold text-secondary">Total (s):</span> {{ st.total_screen_time }}</span>
                      </div>
                      <div class="mt-2">
                        <span class="font-semibold text-accent">App data:</span>
                        <pre class="bg-black/40 rounded p-2 mt-1 text-xs overflow-x-auto">{{ st.app_wise_data|safe }}</pre>
                      </div>
                    </li>
                  {% endfor %}
                </ul>
              </details>
            {% endif %}
          {% endfor %}

          {# Location history #}
          {% if c.location_history.all %}
            <details class="mt-4">
              <summary class="cursor-pointer text-accent font-medium">Location history (last 30 days)</summary>
              <ul class="mt-2 space-y-2">
                {% for loc in c.location_history.all %}
                  <li class="bg-black/30 rounded-lg p-3">
                    <span class="font-semibold text-primary">Time:</span> {{ loc.timestamp }}<br>
                    <span class="font-semibold text-secondary">Lat:</span> {{ loc.latitude }}, <span class="font-semibold text-secondary">Long:</span> {{ loc.longitude }}
                  </li>
                {% endfor %}
              </ul>
            </details>
          {% endif %}

          {# Site access log #}
          {% if c.site_access_logs.all %}
            <details class="mt-4">
              <summary class="cursor-pointer text-accent font-medium">Site access log (last 30 days)</summary>
              <ul class="mt-2 space-y-2">
                {% for log in c.site_access_logs.all %}
                  <li class="bg-black/30 rounded-lg p-3">
                    <span class="font-semibold text-primary">Time:</span> {{ log.timestamp }}<br>
                    <span class="font-semibold text-secondary">URL:</span> {{ log.url }}<br>
                    <span class="font-semibold text-accent">{{ log.accessed|yesno:"Accessed,Blocked" }}</span>
                  </li>
                {% endfor %}
              </ul>
            </details>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="glass-card text-center text-textsec">No children yet.</div>
  {% endif %}
</div>

<div class="glass-card mt-10">
  <h3 class="text-xl font-semibold mb-4 text-secondary uppercase tracking-wide">Create New Child</h3>
  <form method="post" class="space-y-4">
    {% csrf_token %}
    <div class="flex flex-col sm:flex-row gap-4">
      <label class="flex-1">
        <span class="block text-textsec mb-1">First name</span>
        <input type="text" name="first_name" class="w-full rounded-lg bg-black/30 border border-primary px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-textmain" required>
      </label>
      <label class="flex-1">
        <span class="block text-textsec mb-1">Last name</span>
        <input type="text" name="last_name" class="w-full rounded-lg bg-black/30 border border-primary px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-textmain" required>
      </label>
      <label class="flex-1">
        <span class="block text-textsec mb-1">Date of birth</span>
        <input type="date" name="date_of_birth" class="w-full rounded-lg bg-black/30 border border-primary px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-textmain" required>
      </label>
    </div>
    <button type="submit" class="btn-primary mt-4 w-full sm:w-auto">Create Child</button>
  </form>
</div>
{% endblock %}